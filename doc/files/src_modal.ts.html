<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\modal.ts - Event Calendar</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.8.0pr2/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <script src="http://yui.yahooapis.com/combo?3.8.0pr2/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1><a href="../index.html"><img src="../assets/css/logo.png" width="117" height="52">Event Calendar: src\modal.ts</a></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div class="yui3-g">

        <div id="sidebar" class="yui3-u">
            <div id="modules" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Modules</h2>
                </div>
                <div class="bd">
                    <ul>
                            <li><a href="../modules/Calendar.html">Calendar</a>
                            </li>
                    </ul>
                </div>
            </div>
            
            <div id="classes" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Classes</h2>
                </div>
                <div class="bd">
                    <ul>
                            <li><a href="../classes/Dialog.html">Dialog</a></li>
                            <li><a href="../classes/EventCalendar.html">EventCalendar</a></li>
                            <li><a href="../classes/Events.html">Events</a></li>
                            <li><a href="../classes/Header.html">Header</a></li>
                            <li><a href="../classes/Helpers.html">Helpers</a></li>
                            <li><a href="../classes/ModalTemplate.html">ModalTemplate</a></li>
                            <li><a href="../classes/MonthCalendar.html">MonthCalendar</a></li>
                            <li><a href="../classes/MoveAction.html">MoveAction</a></li>
                            <li><a href="../classes/Popover.html">Popover</a></li>
                    </ul>
                </div>
            </div>
            
            
            
            
            
            <div id="fileTree" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Files</h2>
                </div>
                <div class="bd">
                    <ul><li>src\actions.ts/<ul></ul></li><li>src\calendar.ts/<ul></ul></li><li>src\events.ts/<ul></ul></li><li>src\header.ts/<ul></ul></li><li>src\helpers.ts/<ul></ul></li><li>src\modal.ts/<ul></ul></li><li>src\months.ts/<ul></ul></li><li>src\popover.ts/<ul></ul></li></ul>
                </div>
            </div>
            
        </div>

        <div id="main" class="yui3-u">
            <div class="content"><h4>src\modal.ts</h4>

<pre class="code prettyprint linenums">
///&lt;reference path=&quot;../typing/jquery.d.ts&quot; /&gt;
///&lt;reference path=&quot;../typing/bootstrap.d.ts&quot; /&gt;
///&lt;reference path=&quot;../typing/moment.d.ts&quot; /&gt;
///&lt;reference path=&quot;common.ts&quot; /&gt;
///&lt;reference path=&quot;helpers&quot; /&gt;

module Calendar {

    /**
     * Implements modal dialog which contains selected start and end date,
     * component with events to be selected and inputs where user can type
     * some message for other person and/or note for himself. There is available
     * both Submit and Delete button and the cross for closing dialog without
     * applying any changes.
     *
     * @class Dialog
     * @constructor
     * @param {IModalDialog} dialogSettings - Modal dialog settings
     * @property {IModalDialog} dialogSettings - Modal dialog settings
     * @property {[key: string]: any} templateDictionary - Dictionary of placeholders and values necessary for rendering template
     * @property {JQuery} modal - Dialog element
     * @property {DialogResult} [dialogResult=DialogResult.Cancel] - Result of dialog event
     */
    export class Dialog {
        /**
         * Modal dialog settings.
         *
         * @property dialogSettings
         * @type {IModalDialog}
         */
        dialogSettings: IModalDialog;

        /**
         * Dictionary with placeholders and values for rendering template.
         *
         * @property templateDictionary
         * @type { [key: string]: any }
         */
        templateDictionary: { [key: string]: any };

        /**
         * Modal dialog.
         *
         * @property modal
         * @type {JQuery}
         */
        modal: JQuery;

        /**
         * Dialog result from modal action.
         *
         * @property dialogResult
         * @type {DialogResult}
         * @default &quot;DialogResult.Cancel&quot;
         * */
        dialogResult: DialogResult = DialogResult.Cancel;

        constructor(dialogSettings: IModalDialog) {
            this.dialogSettings = dialogSettings;
            this.dialogSettings.selectedEvent = this.dialogSettings.events[0].name;
            this.templateDictionary = this.getDictionary();
        }

        /**
         * Fills &#x60;templateDictionary&#x60; with keys and its values.
         *
         * @method getDictionary
         * @private
         * @return {any} - Returns dictionary template
         */
        private getDictionary(): any {
            var localization = this.dialogSettings.localization;

            return {
                &quot;start&quot;: moment(this.dialogSettings.start).format(&quot;LL&quot;),
                &quot;end&quot;:  moment(this.dialogSettings.end).format(&quot;LL&quot;),
                &quot;dropdown&quot;: Calendar.ModalTemplate.dropdownTemplate(this.dialogSettings),
                &quot;messageSentence&quot;: localization.messageSentence,
                &quot;noteSentence&quot;: localization.noteSentence,
                &quot;submitButton&quot;: localization.submitButton,
                &quot;deleteButton&quot;: localization.deleteButton
            };
        }

        /**
         * Renders modal dialog and binds all necessary events. After closing modal dialog
         * it is removed from DOM.
         *
         * @method show
         * @returns {JQueryPromise&lt;DialogResult&gt;} - Returns promise from modal dialog with dialog result
         */
        show(): JQueryPromise&lt;DialogResult&gt; {
            var deferred = $.Deferred&lt;DialogResult&gt;();

            this.modal = $(Calendar.Helpers.RenderTemplate(Calendar.ModalTemplate.template(), this.templateDictionary)).appendTo($(&quot;body&quot;));
            this.modal.modal();
            this.modal.on(&quot;click&quot;, &quot;.modal-body .dropdown-menu li&quot;, (e) =&gt; this.selectChange(e));
            this.modal.on(&quot;change&quot;, &quot;input&quot;, (e) =&gt; this.messageChanged(e));
            this.modal.on(&quot;click&quot;, &quot;.modal-body .btn-action&quot;, (e) =&gt; this.click(e));
            this.modal.on(&quot;keyup&quot;, (e) =&gt; this.modalKeyup(e));
            this.modal.on(&quot;hidden.bs.modal&quot;, () =&gt; {
                    this.modal.remove();
                    deferred.resolve(this.dialogResult);
                }
            );
            return deferred.promise();
        }

        /**
         * Resolves button click from dialog and calls appropriate method.
         *
         * @method click
         * @param {JQueryEventObject} e - Button object handler
         */
        click(e: JQueryEventObject): void {
            var action = $(e.target).attr(&quot;id&quot;);
            this[action](e);
        }

        /**
         * jQuery keyup() event for enter and escape key.
         * Enter key confirms dialog and escape key closes dialog
         * without changes.
         *
         * @method modalKeyup
         * @param {JQueryEventObject} e - Key event handler
         * */
        modalKeyup(e: JQueryEventObject): void {
            var key = e.keyCode || e.which;
            if(key === 13) {
                this.btnSubmit(e);
            } else if(key === 27){
                this.btnClose(e);
            }
        }

        /**
         * Sets dialogResult to &#x60;DialogResult.Submit&#x60;.
         *
         * @method btnSubmit
         * @param {JQueryEventObject} e - Button object handler
         */
        btnSubmit(e: JQueryEventObject): void {
            this.dialogResult = DialogResult.Submit;
            this.close();
        }

        /**
         * Sets dialogResult to &#x60;DialogResult.Delete&#x60;.
         *
         * @method btnDelete
         * @param {JQueryEventObject} e - Button object handler
         */
        btnDelete(e: JQueryEventObject): void {
            this.dialogResult = DialogResult.Delete;
            this.close();
        }

        /**
         * Sets dialogResult to &#x60;DialogResult.Cancel&#x60;.
         *
         * @method btnClose
         * @param {JQueryEventObject} e - Button object handler
         */
        btnClose(e: JQueryEventObject): void {
            this.dialogResult = DialogResult.Cancel;
            this.close();
        }

        /**
         * Closes modal dialog.
         *
         * @method close
         */
        close(): void {
            this.modal.modal(&quot;hide&quot;);
        }

        /**
         * Applies changes after selecting some event from list component,
         * saves selected item to &#x60;dialogSettings&#x60; property and
         * sets selected item to main button to reflect actual item.
         *
         * @method selectChange
         * @param {JQueryEventObject} e - Selected item event handler
         */
        selectChange(e: JQueryEventObject): void {
            var li = $(e.target).closest(&quot;li&quot;);

            this.dialogSettings.selectedEvent = li.attr(&quot;data-value&quot;);

            var html = li.find(&quot;a&quot;).html(),
                faIndex = html.indexOf(&quot;&lt;i class&quot;),
                htmlWithCaret = html.slice(0, faIndex) + &quot; &lt;span class=&#x27;caret pull-right&#x27;&gt;&lt;/span&gt;&quot; + html.slice(faIndex);

            $(&quot;.calendar-modal .dropdown-toggle&quot;).html(htmlWithCaret);
        }

        /**
         * Saves input text to &#x60;dialogSettings&#x60; property.
         *
         * @method messageChanged
         * @param {JQueryEventObject} e - Input event handler
         */
        messageChanged(e:JQueryEventObject): void {
            var input = $(e.target);

            if(input.attr(&quot;name&quot;) === &quot;userMessage&quot;) {
                this.dialogSettings.message = input.val();
            } else {
                this.dialogSettings.personalNote = input.val();
            }
        }
    }

    /**
     * Static class which contains templates for modal dialog
     *
     * @class ModalTemplate
     * @static
     */
    export class ModalTemplate {

        private static dropdownButton: string = [
            &quot;&lt;div class=&#x27;btn-group&#x27; role=&#x27;group&#x27;&gt;&quot;,
            &quot;   &lt;button type=&#x27;button&#x27; class=&#x27;btn btn-default dropdown-toggle&#x27; data-toggle=&#x27;dropdown&#x27; aria-expanded=&#x27;false&#x27;&gt;&quot;,
            &quot;       {{value}}&quot;,
            &quot;       &lt;span class=&#x27;caret pull-right&#x27;&gt;&lt;/span&gt;&quot;,
            &quot;       &lt;i class=&#x27;fa fa-square pull-right&#x27; style=&#x27;color: {{backgroundColor}}&#x27;&gt;&lt;/i&gt;&quot;,
            &quot;   &lt;/button&gt;&quot;,
            &quot;   &lt;ul class=&#x27;dropdown-menu&#x27; role=&#x27;menu&#x27;&gt;&quot;,
            &quot;       {{dropdownlist}}&quot;,
            &quot;   &lt;/ul&gt;&quot;,
            &quot;&lt;/div&gt;&quot;
        ].join(&quot;\n&quot;);

        private static dropdownList: string = &quot;&lt;li data-value=&#x27;{{value}}&#x27;&gt;&lt;a href=&#x27;#&#x27;&gt;{{value}}&lt;i class=&#x27;fa fa-square pull-right&#x27; style=&#x27;color: {{backgroundColor}};&#x27;&gt;&lt;/i&gt;&lt;/a&gt;&lt;/li&gt;&quot;;

        /**
         * Whole modal dialog html template.
         *
         * @method template
         * @static
         * @return {string} - Returns template
         */
        static template(): string {
            return  [
                &quot;&lt;div class=&#x27;modal calendar-modal&#x27; tabindex=&#x27;-1&#x27; role=&#x27;dialog&#x27; aria-hidden=&#x27;true&#x27;&gt;&quot;,
                &quot;  &lt;div class=&#x27;modal-dialog modal-sm&#x27;&gt;&quot;,
                &quot;    &lt;div class=&#x27;modal-content&#x27;&gt;&quot;,
                &quot;       &lt;div class=&#x27;modal-header&#x27;  style=&#x27;border-bottom: none;&#x27;&gt;&quot;,
                &quot;           &lt;button type=&#x27;button&#x27; class=&#x27;close&#x27; data-dismiss=&#x27;modal&#x27; aria-label=&#x27;Close&#x27;&gt;&lt;span aria-hidden=&#x27;true&#x27;&gt;&amp;times;&lt;/span&gt;&lt;/button&gt;&quot;,
                &quot;       &lt;/div&gt;&quot;,
                &quot;       &lt;div class=&#x27;modal-body&#x27; style=&#x27;padding-top: 0;&#x27;&gt;&quot;,
                &quot;           &lt;div class=&#x27;row&#x27; style=&#x27;padding-bottom: 15px;&#x27;&gt;&quot;,
                &quot;               &lt;div class=&#x27;col-md-12&#x27;&gt;&lt;i class=&#x27;fa fa-calendar-o&#x27;&gt;&lt;/i&gt; {{start}}&lt;/div&gt;&quot;,
                &quot;               &lt;div class=&#x27;col-md-12&#x27;&gt;&lt;i class=&#x27;fa fa-calendar-o&#x27;&gt;&lt;/i&gt; {{end}}&lt;/div&gt;&quot;,
                &quot;           &lt;/div&gt;&quot;,
                &quot;           &lt;div class=&#x27;row&#x27; style=&#x27;padding-bottom: 15px;&#x27;&gt;&quot;,
                &quot;               &lt;div class=&#x27;col-md-12&#x27;&gt;{{dropdown}}&lt;/div&gt;&quot;,
                &quot;           &lt;/div&gt;&quot;,
                &quot;           &lt;form&gt;&quot;,
                &quot;               &lt;div class=&#x27;form-group&#x27;&gt;&quot;,
                &quot;                   &lt;div&gt;{{messageSentence}}&lt;/div&gt;&quot;,
                &quot;                   &lt;input type=&#x27;text&#x27; name=&#x27;userMessage&#x27; class=&#x27;form-control&#x27;&gt;&quot;,
                &quot;               &lt;/div&gt;&quot;,
                &quot;               &lt;div class=&#x27;form-group&#x27;&gt;&quot;,
                &quot;                   &lt;div&gt;{{noteSentence}}&lt;/div&gt;&quot;,
                &quot;                   &lt;input type=&#x27;text&#x27; name=&#x27;privateNote&#x27; class=&#x27;form-control&#x27;&gt;&quot;,
                &quot;               &lt;/div&gt;&quot;,
                &quot;           &lt;/form&gt;&quot;,
                &quot;           &lt;div class=&#x27;row&#x27;&gt;&quot;,
                &quot;               &lt;div class=&#x27;col-md-12&#x27;&gt;&quot;,
                &quot;                   &lt;button type=&#x27;button&#x27; id=&#x27;btnDelete&#x27; class=&#x27;btn btn-default pull-left btn-action&#x27;&gt;{{deleteButton}}&lt;/button&gt;&quot;,
                &quot;                   &lt;button type=&#x27;button&#x27; id=&#x27;btnSubmit&#x27; class=&#x27;btn btn-primary pull-right btn-action&#x27;&gt;{{submitButton}}&lt;/button&gt;&quot;,
                &quot;               &lt;/div&gt;&quot;,
                &quot;           &lt;/div&gt;&quot;,
                &quot;       &lt;/div&gt;&quot;,
                &quot;    &lt;/div&gt;&quot;,
                &quot;  &lt;/div&gt;&quot;,
                &quot;&lt;/div&gt;&quot;
            ].join(&quot;\n&quot;);
        }

        /**
         * Template for dropdown component with events.
         *
         * @method dropdownTemplate
         * @static
         * @param {IModalDialog} dialogSettings - Modal dialog settings
         * @return {string} - Returns partial template
         */
        static dropdownTemplate(dialogSettings: IModalDialog): string {
            var firstEvent = dialogSettings.events[0];

            var dropdownlist = dialogSettings.events.map((item) =&gt; {
                return Calendar.Helpers.RenderTemplate(this.dropdownList, {
                    &quot;value&quot;: item.name,
                    &quot;backgroundColor&quot;: item.backgroundColor || dialogSettings.defaultBgColor
                });
            });

            return Calendar.Helpers.RenderTemplate(this.dropdownButton, {
                &quot;value&quot;: firstEvent.name,
                &quot;backgroundColor&quot;: firstEvent.backgroundColor || dialogSettings.defaultBgColor,
                &quot;dropdownlist&quot;: dropdownlist.join(&quot;&quot;)
            });
        }
    }
}
</pre>

</div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/js/tabs.js"></script>
</body>
</html>
